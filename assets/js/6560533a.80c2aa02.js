"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[57778],{28453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>d});var o=n(296540);const s={},a=o.createContext(s);function i(e){const r=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:r},e.children)}},675590:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>t});const o=JSON.parse('{"id":"multi-empresa/guias-adicionales/migracion-entre-servidores","title":"Migraci\xf3n de su proyecto entre servidores","description":"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro.","source":"@site/Pro7/multi-empresa/guias-adicionales/05-migracion-entre-servidores.md","sourceDirName":"multi-empresa/guias-adicionales","slug":"/multi-empresa/guias-adicionales/migracion-entre-servidores","permalink":"/pro7/multi-empresa/guias-adicionales/migracion-entre-servidores","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"docs","previous":{"title":"Migracion del Pro5 a Pro6","permalink":"/pro7/multi-empresa/guias-adicionales/migracion-pro5-pro6"},"next":{"title":"Proceso de creaci\xf3n de AAB y publicaci\xf3n","permalink":"/pro7/multi-empresa/guias-adicionales/Proceso-de-creaci\xf3n-de-aab-y-publicaci\xf3n"}}');var s=n(474848),a=n(28453);const i={},d="Migraci\xf3n de su proyecto entre servidores",l={},t=[{value:"Tener en cuenta",id:"tener-en-cuenta",level:2},{value:"Pasar datos dentro de un servidor a otro",id:"pasar-datos-dentro-de-un-servidor-a-otro",level:2},{value:"Configurar archivos",id:"configurar-archivos",level:2},{value:"Editar el archivo de docker-compose",id:"editar-el-archivo-de-docker-compose",level:3},{value:"Cambiar el puerto de FPM dentro del proxy",id:"cambiar-el-puerto-de-fpm-dentro-del-proxy",level:3},{value:"Cambiar el host de la base de datos en el .env",id:"cambiar-el-host-de-la-base-de-datos-en-el-env",level:3},{value:"Posibles errores",id:"posibles-errores",level:2},{value:"Identificar posibles errores",id:"identificar-posibles-errores",level:3}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"migraci\xf3n-de-su-proyecto-entre-servidores",children:"Migraci\xf3n de su proyecto entre servidores"})}),"\n",(0,s.jsx)(r.p,{children:"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro."}),"\n",(0,s.jsx)(r.h2,{id:"tener-en-cuenta",children:"Tener en cuenta"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"En el servidor se tiene que revisar que puertos y nombres del contenedor esta disponible para evitar conflictos."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Tener un backup de sus datos."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"pasar-datos-dentro-de-un-servidor-a-otro",children:"Pasar datos dentro de un servidor a otro"}),"\n",(0,s.jsx)(r.p,{children:"Con los siguientes comandos traslada sus datos al otro servidor."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# Copia los certificados del proyecto\r\nrsync -avzh /root/certs {ip del servidor a migrar}:/root/ \r\n\r\n# Copia el el datos del proxy del proyecto al servidor\r\nrsync -avzh /root/proxy {ip del servidor a migrar}:/root/              \r\n\r\n# Copia todo el proyecto al root del servidor\r\nrsync -avzh -q /root/ {ip del servidor a migrar}:/root/                \r\n\r\n# Copia los volumenes de la base de datos\r\nrsync -avzh -q /var/lib/docker/volumes/ {ip del servidor a migrar}:/var/lib/docker/volumes/ \n"})}),"\n",(0,s.jsxs)(r.p,{children:["Una vez se haya terminado la transferencia de datos, tiene que dirigrse dentro de ",(0,s.jsx)(r.code,{children:"cd /var/lib/docker/volumes/"}),", ac\xe1 se encontrar\xe1 las carpetas de mysql y redis."]}),"\n",(0,s.jsx)(r.p,{children:"Se tiene que cambiar los nombre de la carepta respecto a lo que se ha elegido previamente. Con estos comandos se puede cambiar los nombres de la carpeta."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"#Se esta usando nombres de ejemplos\r\n# |nombre de carpeta actual | nombre de carpeta modificada |    \r\nmv pro6.buho.xyz_mysqldata1   pro6.buho.xyz_mysqldata2\n"})}),"\n",(0,s.jsx)(r.h2,{id:"configurar-archivos",children:"Configurar archivos"}),"\n",(0,s.jsx)(r.p,{children:"Antes de levantar el proyecto, se tiene que configurar algunos archivos."}),"\n",(0,s.jsx)(r.h3,{id:"editar-el-archivo-de-docker-compose",children:"Editar el archivo de docker-compose"}),"\n",(0,s.jsxs)(r.p,{children:["En este ejemplo se tomar\xe1 como ejemplo que la carpeta tenga el nombre de ",(0,s.jsx)(r.strong,{children:"pro6.buho.xyz"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3\'\r\n\r\nservices:\r\n    nginx{numero nuevo}:\r\n        image: rash07/nginx\r\n        container_name: nginx_pro6_buho_xyz\r\n        working_dir: /var/www/html\r\n        environment:\r\n            VIRTUAL_HOST: pro6.buho.xyz, *.pro6.buho.xyz\r\n        volumes:\r\n            - ./:/var/www/html\r\n            - /root/proxy/fpms/pro6.buho.xyz:/etc/nginx/sites-available\r\n        restart: always\r\n    fpm{numero nuevo}:\r\n        image: rash07/php-fpm:2.0\r\n        container_name: fpm_pro6_buho_xyz\r\n        working_dir: /var/www/html\r\n        volumes:\r\n            - ./ssh:/root/.ssh\r\n            - ./ssh:/var/www/.ssh\r\n            - ./:/var/www/html\r\n        restart: always\r\n    mariadb{numero nuevo}:\r\n        image: mariadb:10.5.6\r\n        container_name: mariadb_pro6_buho_xyz\r\n        environment:\r\n            - MYSQL_USER=\\${MYSQL_USER}\r\n            - MYSQL_PASSWORD=\\${MYSQL_PASSWORD}\r\n            - MYSQL_DATABASE=\\${MYSQL_DATABASE}\r\n            - MYSQL_ROOT_PASSWORD=\\${MYSQL_ROOT_PASSWORD}\r\n            - MYSQL_PORT_HOST=\\${MYSQL_PORT_HOST}\r\n        volumes:\r\n            - mysqldata{numero nuevo}:/var/lib/mysql\r\n        ports:\r\n            - "\\${MYSQL_PORT_HOST}:3306"\r\n        restart: always\r\n    redis{numero nuevo}:\r\n        image: redis:alpine\r\n        container_name: redis_pro6_buho_xyz\r\n        volumes:\r\n            - redisdata{numero nuevo}:/data\r\n        restart: always\r\n    scheduling{numero nuevo}:\r\n        image: rash07/scheduling\r\n        container_name: scheduling_pro6_buho_xyz\r\n        working_dir: /var/www/html\r\n        volumes:\r\n            - ./:/var/www/html\r\n        restart: always\r\n    supervisor{numero nuevo}:\r\n        image: rash07/php7.4-supervisor\r\n        container_name: supervisor_pro6_buho_xyz\r\n        working_dir: /var/www/html\r\n        volumes:\r\n            - ./:/var/www/html\r\n            - ./supervisor.conf:/etc/supervisor/conf.d/supervisor.conf\r\n        restart: always\r\n\r\nnetworks:\r\n    default:\r\n        external:\r\n            name: proxynet\r\n\r\nvolumes:\r\n    redisdata{numero nuevo}:\r\n        driver: "local"\r\n    mysqldata{numero nuevo}:\r\n        driver: "local"\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["En el ejemplo de arriba, el texto de ",(0,s.jsx)(r.strong,{children:'"{numero nuevo}"'}),", se tiene que cambiar a un nombre disponible (por ejemplo ",(0,s.jsx)(r.strong,{children:"nginx12"}),") que se encunetra dentro de tu servidor. Puedes nombrar los contenedores con ",(0,s.jsx)(r.code,{children:"docker ps"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"cambiar-el-puerto-de-fpm-dentro-del-proxy",children:"Cambiar el puerto de FPM dentro del proxy"}),"\n",(0,s.jsxs)(r.p,{children:["Tienes que dirigir a ",(0,s.jsx)(r.code,{children:"cd ~/proxy/fpms/{nombre de tu proyecto}/"}),", se ver\xe1 el archivo ",(0,s.jsx)(r.strong,{children:"default"}),", ingresa con ",(0,s.jsx)(r.code,{children:"nano default"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-nginx",metastring:'title="default"',children:"server {\r\n    listen 80 default_server;\r\n    root /var/www/html/public;\r\n    index index.html index.htm index.php;\r\n    server_name *._;\r\n    charset utf-8;\r\n    server_tokens off;\r\n    location = /favicon.ico {\r\n        log_not_found off;\r\n        access_log off;\r\n    }\r\n    location = /robots.txt {\r\n        log_not_found off;\r\n        access_log off;\r\n    }\r\n    location / {\r\n        try_files $uri $uri/ /index.php$is_args$args;\r\n    }\r\n    location ~ \\.php$ {\r\n        include snippets/fastcgi-php.conf;\r\n        fastcgi_pass fpm{numero nuevo}:9000;\r\n        fastcgi_read_timeout 3600;\r\n    }\r\n    error_page 404 /index.php;\r\n    location ~ /\\.ht {\r\n        deny all;\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["En la ",(0,s.jsx)(r.strong,{children:"fastcgi_pass"})," se tiene que cambiar con el nombre que se puso para el fpm dentro del docker-compose."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"cambiar-el-host-de-la-base-de-datos-en-el-env",children:"Cambiar el host de la base de datos en el .env"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",metastring:'title=".env"',children:"DB_HOST={nombre del contenedor de la base dedatos}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["En ",(0,s.jsx)(r.strong,{children:"DB_HOST"})," se tiene que colocar el nombre de la base de datos que lo colocaste en el docker-compose.yml."]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Despu\xe9s de ello, tiene que buscar lo siguiente"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",metastring:'title=".env"',children:"MYSQL_PORT_HOST={puerto libre de tu vps}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Aqu\xed debes colocar un puerto libre de tu sistema para que la base de datos funcione."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"posibles-errores",children:"Posibles errores"}),"\n",(0,s.jsx)(r.h3,{id:"identificar-posibles-errores",children:"Identificar posibles errores"}),"\n",(0,s.jsxs)(r.p,{children:["Para poder ver si hay errores dentro de los contenedores, primero visualizalos con ",(0,s.jsx)(r.code,{children:"docker ps"})]}),"\n",(0,s.jsxs)(r.p,{children:["Si encuentras que dentro del rseultado, en uno de los contenedores dentro de us categor\xeda ",(0,s.jsx)(r.strong,{children:"STATUS"})," no aparece levntando (UP), entonces en ese contenedor hubo un error."]}),"\n",(0,s.jsx)(r.p,{children:"Para poder mostrar los logs del contenedor, puede usar el siguiente comando"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"docker logs --tail 20 {contenedor}\n"})}),"\n",(0,s.jsx)(r.p,{children:"Gracias a esto podemos revisar sus registros e identificar sus posibles errores."})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);