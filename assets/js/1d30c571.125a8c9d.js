"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[75153],{28453:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>d});var n=s(296540);const a={},i=n.createContext(a);function c(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),n.createElement(i.Provider,{value:r},e.children)}},79345:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"devs/devops/migracion-server-docker","title":"Migraci\xf3n de Servidor con Docker","description":"---","source":"@site/Pro7/devs/devops/migracion-server-docker.md","sourceDirName":"devs/devops","slug":"/devs/devops/migracion-server-docker","permalink":"/pro7/devs/devops/migracion-server-docker","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Migraci\xf3n de Documento Individual","permalink":"/pro7/devs/devops/migracion-de-documento-individual"},"next":{"title":"Gu\xeda de Migraci\xf3n del Proyecto Facturador","permalink":"/pro7/devs/devops/migracion"}}');var a=s(474848),i=s(28453);const c={},d="Migraci\xf3n de Servidor con Docker",l={},o=[{value:"Prop\xf3sito",id:"prop\xf3sito",level:2},{value:"Requisitos",id:"requisitos",level:2},{value:"Servidor A",id:"servidor-a",level:2},{value:"Servidor B",id:"servidor-b",level:2},{value:"Env\xedo de Data",id:"env\xedo-de-data",level:2},{value:"Desde el Servidor A hacia el Servidor B",id:"desde-el-servidor-a-hacia-el-servidor-b",level:3},{value:"Despliegue",id:"despliegue",level:2}];function t(e){const r={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"migraci\xf3n-de-servidor-con-docker",children:"Migraci\xf3n de Servidor con Docker"})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#prop%C3%B3sito",children:"Prop\xf3sito"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#requisitos",children:"Requisitos"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#servidor-a",children:"Servidor A"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#servidor-b",children:"Servidor B"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#env%C3%ADo-de-data",children:"Env\xedo de Data"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"#despliegue",children:"Despliegue"})}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"prop\xf3sito",children:"Prop\xf3sito"}),"\n",(0,a.jsx)(r.p,{children:"Migrar todos los datos del facturador de un servidor A a un servidor B."}),"\n",(0,a.jsx)(r.h2,{id:"requisitos",children:"Requisitos"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Acceso SSH a ambos servidores."}),"\n",(0,a.jsx)(r.li,{children:"Misma versi\xf3n de sistemas operativos en ambos servidores."}),"\n",(0,a.jsx)(r.li,{children:"Si posee un archivo SSH como clave en formato .ppk, convertir a formato .pem."}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"servidor-a",children:"Servidor A"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Ingresar al servidor e instalar ",(0,a.jsx)(r.code,{children:"zip"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"apt-get install zip unzip\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Crear una carpeta ",(0,a.jsx)(r.code,{children:"scp"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mkdir scp\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Copiar el contenido de las carpetas ",(0,a.jsx)(r.code,{children:"proxy"})," y ",(0,a.jsx)(r.code,{children:"certs"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cp -r proxy/ scp/\r\ncp -r certs/ scp/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Verificar el tama\xf1o del directorio del facturador:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"du -sh facturador/\n"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Si el tama\xf1o es inferior a 5GB, se recomienda usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"zip -r facturador.zip facturador/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Si es mayor, usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"tar -cvf facturador.tar facturador/\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Mover el archivo comprimido a ",(0,a.jsx)(r.code,{children:"scp"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mv facturador.zip scp/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Ir a la carpeta de vol\xfamenes de Docker:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd /var/lib/docker/volumes/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Verificar el tama\xf1o del volumen de base de datos:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"du -sh facturador1_mysqldata_1\n"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Si el tama\xf1o es inferior a 5GB, se recomienda usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"zip -r mysql.zip facturador1_mysqldata_1/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Si es mayor, usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"tar -cvf mysql.tar facturador1_mysqldata_1/\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Mover el archivo comprimido a ",(0,a.jsx)(r.code,{children:"scp"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mv mysql.zip /ruta/scp/\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Advertencia:"})," Si la instalaci\xf3n es muy antigua (versi\xf3n PRO3 que ha venido actualizando), verificar la versi\xf3n de MySQL directamente en el contenedor de MariaDB:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"docker exec -ti CONTENEDOR_MYSQL mysql --version\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Dicha versi\xf3n debe asignarse en el archivo ",(0,a.jsx)(r.code,{children:"docker-compose.yml"})," dentro del facturador."]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"servidor-b",children:"Servidor B"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Ingresar al servidor e instalar ",(0,a.jsx)(r.code,{children:"zip"}),":","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"apt-get install zip unzip\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Instalar las dependencias en el servidor:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:'apt-get -y update\r\napt-get -y install git-core\r\napt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\r\nadd-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\r\napt-get -y update\r\napt-get -y install docker-ce\r\nsystemctl start docker\r\nsystemctl enable docker\r\ncurl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\r\nchmod +x /usr/local/bin/docker-compose\r\napt-get -y install letsencrypt\r\ndocker network create proxynet\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"env\xedo-de-data",children:"Env\xedo de Data"}),"\n",(0,a.jsx)(r.h3,{id:"desde-el-servidor-a-hacia-el-servidor-b",children:"Desde el Servidor A hacia el Servidor B"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Enviar la carpeta ",(0,a.jsx)(r.code,{children:"scp"})," completa hacia el servidor B."]}),"\n",(0,a.jsxs)(r.li,{children:["Si el servidor B usa archivo de clave (.pem) para conectarse, debe cargarlo previamente:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Sintaxis\r\n# scp -r -i [clave] [carpeta_local] [USUARIO]@[IP]:[/ruta/destino]\r\n# Ejemplo\r\nscp -r -i clave.pem scp/ root@192.196.138.123:/root/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Si el servidor B no usa archivo de clave:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Sintaxis\r\n# scp -r [carpeta_local] [USUARIO]@[IP]:[/ruta/destino]\r\n# Ejemplo\r\nscp -r scp/ root@192.196.138.123:/root/\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"despliegue",children:"Despliegue"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Ingresar a la carpeta ",(0,a.jsx)(r.code,{children:"scp"})," y descomprimir los archivos:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd scp\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Si son archivos ",(0,a.jsx)(r.code,{children:".zip"}),", usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"unzip facturador.zip\r\nunzip mysql.zip\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Si son archivos ",(0,a.jsx)(r.code,{children:".tar"}),", usar:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"tar -xvf facturador.tar\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Mover las carpetas a la ruta destino (suele ser ",(0,a.jsx)(r.code,{children:"/root"})," o ",(0,a.jsx)(r.code,{children:"/home/usuario"}),"):","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mv proxy /ruta_destino/\r\nmv facturador /ruta_destino/\r\nmv certs /ruta_destino/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Mover la carpeta de MySQL a la ruta de vol\xfamenes de Docker:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mv facturador1_mysqldata_1/ /var/lib/docker/volumes/\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Ingresar a la carpeta del facturador y levantar los servicios:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd /ruta_destino/facturador/\r\ndocker-compose up -d\n"})}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["Ingresar a la carpeta del proxy y levantar los servicios:","\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd /ruta_destino/proxy/\r\ndocker-compose up -d\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"Si todo est\xe1 correcto, solo quedar\xe1 cambiar la IP a la que apunta el dominio."})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}}}]);